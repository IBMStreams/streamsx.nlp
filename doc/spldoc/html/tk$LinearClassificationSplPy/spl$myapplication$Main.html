<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2005"/>
<meta name="DC.rights.owner" content="(C) Copyright 2005"/>
<meta name="DC.Type" content="reference"/>
<meta name="DC.Title" content="SPL File Main.spl"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="spldoc_compilationunit"/>
<link rel="stylesheet" type="text/css" href="../../html/commonltr.css"/>
<link rel="stylesheet" type="text/css" href="../../html/spldoc.css"/>
<title>SPL File Main.spl</title>
</head>
<body id="spldoc_compilationunit">


<h1 class="title topictitle1">SPL File <tt class="ph tt">Main.spl</tt></h1>

<div class="body refbody">
<div class="section">
<p class="p">
<a class="xref" href="../toolkits/toolkits.html">Toolkits</a> &gt; <a class="xref" href="tk$LinearClassificationSplPy.html">LinearClassificationSplPy 1.0.0</a> &gt; <a class="xref" href="ns$myapplication.html">myapplication</a> &gt; Main.spl</p>

</div>

<div class="section"><h2 class="title sectiontitle splhead-1">Content</h2>
  
  <dl class="dl">
    <dt class="dt dlterm"/>
<dd class="dd"/>

    
      <dt class="dt dlterm splhead-2">Operators</dt>

      <dd class="dd">
<ul class="sl simple">
<li class="sli"><strong class="ph b"><a class="xref" href="spl$myapplication$Main.html#spldoc_compilationunit__composite_operator__Main">Main</a></strong>: This main composite demonstrates the use of Linear Classification algorithm from the Python sklearn module.
</li>

</ul>

      </dd>

    
  </dl>

</div>

<div class="section"><h2 class="title sectiontitle splhead-1">Composites</h2>
  
</div>

<div class="section" id="spldoc_compilationunit__composite_operator__Main"><h2 class="title sectiontitle splpart">composite Main</h2>
  
</div>

<div class="section splgraph">
  <embed class="image" src="../../image/tk$LinearClassificationSplPy/op$myapplication$Main.svg" width="547" height="154"/>
</div>

<div class="section">

<p class="p">This main composite demonstrates the use of Linear Classification algorithm from the Python sklearn module.
</p>

<p class="p">The example requires the 'streams.topology' toolkit at least version v1.5.11. The recommended Streams version is 4.2.
</p>

<p class="p">The LinearClassification Operator is defines in python module 'mysamples.py' in directory opt/python/streams. This sample reads training data from a file 'training.csv' and the data to classify from file 'in.txt'. When no training is ongoing, the data tuples are passed directly to the LinearClassification Operator. During the training, data tuples are not transfered to the LinearClassification Operator but they are stored in a queue. When the training has finished, theses tuples are passed from the queue to the phyton operator. When a new training file is moved into the data directory  (atomic move), the operator is re-trained. Classification results are printed. Submission parameter verbose=True produces diagnostics output. 
</p>

</div>

<div class="section"><h2 class="title sectiontitle">Parameters</h2>

<ul class="sl simple">
<li class="sli"><strong class="ph b">verbose</strong>
</li>

</ul>

</div>

<div class="section">
</div>

<div class="section">
</div>

<div class="section"><h2 class="title sectiontitle splhead-2">SPL Source Code</h2>
  
</div>


<div class="section">
   <pre class="pre codeblock">

 public composite Main {
 	param
 		expression&lt;rstring&gt; $verbose : getSubmissionTimeValue("verbose", "");
 	graph
 		/** Data inlet for the training data */
 		stream&lt;rstring fname&gt; TrainingFileNamesStream as O = DirectoryScan() {
 			param
 				directory : ".";
 				pattern : "training.*";
 		}
 		stream&lt;rstring corpus, rstring classes&gt; TrainigStream0 as O = FileSource(TrainingFileNamesStream) {}
 		
 		/** Data inlet for the production tuples */
 		stream&lt;rstring ln&gt; SourceStream = FileSource() { 
 			param
 				file: "in.txt"; 
 				format: line;
 		}
 		
 		/** Custom operator for the locking of the production tuples during training */
 		stream&lt;rstring training, rstring corpus, rstring classes, rstring ln, rstring end&gt; CombinedStream as O = Custom(TrainigStream0 as T; SourceStream as S) {
 			logic
 				state : {
 					mutable list&lt;rstring&gt; buffer = [];
 					mutable boolean trainingState = true;
 				}
 				onTuple S : {
 					if (trainingState) {
 						appendM(buffer, S.ln);
 					} else {
 						submit({training = "", corpus = "", classes = "", ln = S.ln, end = ""}, O);
 					}
 				}
 				onTuple T : {
 					trainingState = true;
 					submit({training = "True", corpus = T.corpus, classes = T.classes, ln = "", end = ""}, O);
 				}
 				onPunct T : {
 					submit({training = "", corpus = "", classes = "", ln = "", end = "True"}, O);
 					trainingState = false;
 					mutable int32 i = 0;
 					while (i &lt; size(buffer)) {
 						submit({training = "", corpus = "", classes = "", ln = buffer[i], end = ""}, O);
 						i++;
 					}
 					clearM(buffer);
 				}
 		}
 		
 		/** The Python sklearn linear classification */
 		stream&lt;rstring pred, rstring decision, rstring classes, rstring ln&gt; ResultStream = LinearClassification(CombinedStream as I) {
 			param
 				verbose : $verbose;
 		}
 		
 		() as Printer = Custom(ResultStream as I) {
 			logic
 				onTuple I : println(I);
 				onPunct I : println(currentPunct());
 		}
 
 }

   </pre>

</div>

</div>


</body>
</html>